<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>WebSocket Test Client</title>
</head>
<body>
<h1>WebSocket Test Client</h1>

<div>
    <input type="text" id="tokenInput" placeholder="JWT í† í° ì…ë ¥">
    <button onclick="connectWebSocket()">Connect</button>
</div>

<div>
    <input type="text" id="messageInput" placeholder="ë³´ë‚¼ ë©”ì‹œì§€ ì…ë ¥">
    <button onclick="sendMessage()">Send</button>
</div>

<div>
    <h3>Logs</h3>
    <pre id="logs"></pre>
</div>

<script>
    let socket;
    const logs = document.getElementById("logs");

    function log(message) {
        logs.textContent += message + "\n";
    }

    // WebSocket ì—°ê²°
    function connectWebSocket() {
        const token = document.getElementById("tokenInput").value.trim();
        if (!token) {
            alert("JWT í† í°ì„ ì…ë ¥í•˜ì„¸ìš”!");
            return;
        }

        // ê¸°ì¡´ ì—°ê²°ì´ ìˆìœ¼ë©´ ì¢…ë£Œ
        if (socket && socket.readyState === WebSocket.OPEN) {
            socket.close();
        }

        // URLì— token ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬
        socket = new WebSocket("ws://localhost:8080/ws-stomp?token=" + encodeURIComponent(token));

        socket.onopen = () => log("âœ… Connected to server");
        socket.onmessage = (event) => log("ğŸ“© Received: " + event.data);
        socket.onclose = () => log("âŒ Disconnected from server");
        socket.onerror = (error) => log("âš ï¸ Error: " + JSON.stringify(error));
    }

    // ë©”ì‹œì§€ ë³´ë‚´ê¸°
    function sendMessage() {
        if (!socket || socket.readyState !== WebSocket.OPEN) {
            alert("WebSocketì— ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!");
            return;
        }

        const msg = {
            message: document.getElementById("messageInput").value,
            receiveId: parseInt(prompt("ë°›ëŠ” ì‚¬ëŒ ID ì…ë ¥"), 10)
        };

        socket.send(JSON.stringify(msg));
        log("ğŸ“¤ Sent: " + JSON.stringify(msg));
    }
</script>
</body>
</html>
